<!DOCTYPE html>
<html xml:th="https://www.thymeleaf.org">
<head th:replace="Components :: head('COMT Newsroom')"></head>
<body class="bg-1 text-1">
<div th:replace="moderator/ModeratorComponents :: moderatorNav"></div>

<main class="container mt-3">
    <div th:replace="moderator/ModeratorComponents :: lightNavigation"></div>

    <div class="row d-flex">
        <div class="col-12 col-md-7 h-100">
            <div class="container-fluid bg-2 py-3" id="overview-container">
            </div>
        </div>
        <div class="col-12 col-md-5 h-100">
            <div class="container-fluid bg-2 py-3">
                <h3 class="fw-bold mb-2">Actions</h3>
                <div class="action-button-container">
                    <div class="action-button" data-bs-toggle="modal" data-bs-target="#new-news-modal">
                        <img th:src="@{/icons/New.svg}" />
                        <p class="text-center">New</p>
                    </div>
                    <div class="action-button" id="refresh-button">
                        <img th:src="@{/icons/Refresh.svg}" />
                        <p class="text-center">Refresh</p>
                    </div>
                    <div class="action-button" id="disable-all-button">
                        <img th:src="@{/icons/Disable.svg}" />
                        <p class="text-center">Disable All</p>
                    </div>
                    <div class="action-button" id="private-all-button">
                        <img th:src="@{/icons/Private.svg}" />
                        <p class="text-center">Private All</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid" id="error-container">

    </div>
    <div class="container-fluid bg-2 mt-4" id="news-container">
        <!-- lights here -->
        <table class="table table-sm align-middle table-hover table-dark">
            <thead>
            <tr>
                <th scope="col">Address</th>
                <th scope="col">ID</th>
                <th scope="col">Label</th>
                <th scope="col">Modified</th>
                <th scope="col">Status</th>
                <th scope="col">Last Connected</th>
                <th scope="col">Color</th>
                <th scope="col">Pattern</th>
                <th scope="col">Favorite</th>
                <th scope="col">Public</th>
                <th scope="col">Enabled</th>
                <th scope="col">Sync</th>
                <th scope="col">Edit</th>
                <th scope="col">Delete</th>
            </tr>
            </thead>
            <tbody id="table-body">
            </tbody>
        </table>
    </div>
</main>

<div class="modal fade" id="new-news-modal" tabindex="-1" aria-labelledby="newNewsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content border-box">
            <div class="modal-header">
                <h5 class="modal-title" id="newLightModalLabel">Add New Light</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="new-light-form">
                    <div class="mb-3">
                        <label for="address-input" class="form-label">IP Address</label>
                        <input type="text" class="form-control" id="address-input">
                    </div>
                    <div class="mb-3">
                        <label for="label-input" class="form-label">Label</label>
                        <input type="text" class="form-control" id="label-input">
                    </div>
                    <div class="mb-3">
                        <label for="color-input" class="form-label">Color</label>
                        <input type="text" class="form-control" id="color-input">
                    </div>
                    <div class="mb-3">
                        <label for="pattern-input" class="form-label">Pattern</label>
                        <input type="text" class="form-control" id="pattern-input">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="saveLight()">Save</button>
            </div>
        </div>
    </div>
</div>


<div th:replace="Components :: JS"></div>
<div th:replace="Components :: scripts"></div>
<script>
    //data
    let overviewData;

    const overviewContainer = document.querySelector("#overview-container");
    const errorContainer = document.querySelector("#news-container");

    //GET functions
    function updateAnalytics(){
        fetch("/api/management/newsroom/analytics")
            .then(checkStatus)
            .then(response => response.json())
            .then(data => {
                overviewData = data;
                renderAnalytics();
            })
            .catch(error => {
                // error handling
                errorContainer.innerHTML = "<h3 class=\"text-center\">There was an error receiving data from Costi Online Services</h3><p class=\"text-center\">Please check the console for further information</p>";
                console.error('Error retrieving data:', error);
            });
    }
    updateAnalytics();


    //Render
    function renderAnalytics(){
        overviewContainer.innerHTML = `
            <h3 class="fw-bold mb-2">Overview</h3>
            <div id="stats-container">
                <div>
                    <p class="fs-1 fw-bold  text-center">${overviewData["totalViews"]}</p>
                    <p class="text-center">All Views</p>
                </div>
                <div>
                    <p class="fs-1 fw-bold  text-center">${overviewData["totalEnabled"]}</p>
                    <p class="text-center">Enabled</p>
                </div>
                <div class="d-none d-lg-block">
                    <p class="fs-1 fw-bold  text-center">${overviewData["totalDisabled"]}</p>
                    <p class="text-center">Disabled</p>
                </div>
                <div class="d-none d-lg-block">
                    <p class="fs-1 fw-bold  text-center">${overviewData["totalPublic"]}</p>
                    <p class="text-center">Public</p>
                </div>
                <div>
                    <p class="fs-1 fw-bold  text-center">${overviewData["averageBodyLength"]}</p>
                    <p class="text-center">Î¼ Length</p>
                </div>
            </div>

        `;
    }

</script>
</body>
</html>