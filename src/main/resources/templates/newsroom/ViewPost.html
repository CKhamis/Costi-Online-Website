<!DOCTYPE html>
<html xml:th="https://www.thymeleaf.org">
<head th:replace="Components :: head('View Post')"></head>
<body class="bg-1 text-1">
<div th:replace="Components :: main-navigation"></div>

<main class="container-fluid mt-3">
    <input id="id-selector" type="hidden" th:value="${id}"/>
    <div class="row">
        <div class="d-none d-md-block col-md-3 px-5">
            <h3 class="text-secondary fw-bold" id="left-category">Category</h3>
<!--            <th:block th:each="related : ${relatedPosts}">-->
<!--                <a th:href="|/Newsroom/*{related.getId()}/view|">-->
<!--                    <img th:src="@{*{related.getImagePath()}}" style="aspect-ratio: 16 / 9; object-fit:cover;width: 100%;"/>-->
<!--                    <div class="mb-5">-->
<!--                        <h4 class="fw-bold text-1 text-decoration-none" th:text="*{related.getTitle()}"></h4>-->
<!--                        <p class="text-secondary mb-5" th:text="|${related.getTimeSinceEdited()}|"></p>-->
<!--                    </div>-->
<!--                </a>-->
<!--            </th:block>-->
<!--            <div th:if="${relatedPosts.isEmpty()}">-->
<!--                <p>No posts :(</p>-->
<!--            </div>-->
        </div>
        <div class="col-12 col-md-8 col-lg-6" id="body-content">
            <div class="row">
                <div class="col col-md-8 d-none d-md-block">
                    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/" class="text-1">Costi Online</a></li>
                            <li class="breadcrumb-item"><a href="/Newsroom" class="text-1">Newsroom Home</a></li>
                            <li class="breadcrumb-item active text-1" aria-current="page" id="breadcrumb-title"></li>
                        </ol>
                    </nav>
                </div>
                <a href="/Newsroom" class="text-secondary d-block d-md-none">< Back to Newsroom</a>
                <div class="col col-md-4 d-none d-md-block">
                    <p id="header-last-edited" class="text-end text-secondary"></p>
                </div>
            </div>
            <img id="body-image" class="newsroom-slide"/>

            <h1 class="fw-bold mb-0" id="body-title"></h1>
            <h4 class="text-muted fw-bold" id="body-subtitle"></h4>

            <div id="status"></div>

            <div>
                <p class="fs-5" id="body-body"></p>
            </div>

            <a class="btn btn-primary btn-sm d-inline" th:href="@{|/COMT/Newsroom/${id}/edit|}" th:if="${isOwner}">Edit</a>
            <a class="btn btn-secondary btn-sm d-inline" href="/COMT/Newsroom" th:if="${isOwner}">COMT</a>
            <p id="body-views"></p>
            <a href="/Newsroom" class="text-secondary d-block d-md-none">< Back to Newsroom</a>

        </div>
        <div class="d-none d-lg-block col-lg-3 px-lg-5">
            <h3 class="text-secondary fw-bold">Recent content</h3>
<!--            <th:block th:each="recent : ${recentPosts}">-->
<!--                <a th:href="|/Newsroom/*{recent.getId()}/view|">-->
<!--                    <img th:src="@{*{recent.getImagePath()}}" style="aspect-ratio: 16 / 9; object-fit:cover;width: 100%;"/>-->
<!--                    <h4 class="fw-bold text-1 text-decoration-none" th:text="*{recent.getTitle()}"></h4>-->
<!--                    <p class="text-secondary mb-5" th:text="|${recent.getTimeSinceEdited()}|"></p>-->
<!--                </a>-->
<!--            </th:block>-->
<!--            <div th:if="${recentPosts.isEmpty()}">-->
<!--                <p>No posts :(</p>-->
<!--            </div>-->
        </div>
    </div>
</main>

<div th:replace="Components :: footer"></div>
<div th:replace="Components :: JS"></div>
<div th:replace="Components :: scripts"></div>
<script>
    const bodyContent = document.getElementById("body-content");
    let url = `/api/newsroom/view?id=${document.getElementById("id-selector").value}`;
    let post;
    fetch(url)
        .then(checkStatus)
        .then(response => response.json())
        .then(data => {
            // Process the retrieved data
            post = data;
            console.log(data);
            if(data == null){
                post = {
                    "id":-1,
                    "title":"No Posts Found",
                    "lastEdited":"2023-01-01T19:03:46",
                    "subtitle":"",
                    "enabled":true,
                    "public": true,
                    "category":"NEWS",
                    "body":"No body content",
                    "imagePath":"images/default-posts/no-image.jpg",
                    "views":0,
                    "dateEdited":"1/1/2023",
                    "timeSinceEdited":"?",
                    "timeSinceEditedShort":"?",
                    "pinned":false,
                    "featured":false,
                    "favorite":false
                }
            }

            renderNews();
        })
        .catch(error => {
            // error handling
            bodyContent.innerHTML = `<h3 class=\"text-center fw-bold\">There was an error receiving data from Costi Online Services</h3><p class=\"text-center\">$[error}</p>`;
            console.error('Error retrieving data:', error);
        });

    function renderNews(){
        document.getElementById("breadcrumb-title").textContent = post.title;
        document.getElementById("body-title").textContent = post.title;
        document.getElementById("body-subtitle").textContent = post.subtitle;
        document.getElementById("header-last-edited").textContent = `Last Edited: ${post.lastEdited}`;
        document.getElementById("body-views").textContent = `Views: ${post.views}`;
        document.getElementById("body-image").src = post.imagePath;
        document.getElementById("body-body").innerHTML = post.body;
        document.getElementById("status").innerHTML = !post.public ? "<div class=\"alert alert-secondary text-center\" role=\"alert\"><h4>This post is unlisted</h4></div>": "";
    }
</script>
</body>
</html>