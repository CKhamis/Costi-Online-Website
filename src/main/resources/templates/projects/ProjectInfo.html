<!DOCTYPE html>
<html xml:th="https://www.thymeleaf.org">
<head th:replace="~{Components :: head('Project Info')}"></head>
<div th:replace="~{Components :: main-navigation}"></div>

<body class="bg-1 text-1">
<input type="hidden" th:value="${name}" id="projectName"/>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-4 p-2">
            <div class="border-box h-lg-100 d-flex flex-column p-3">
                <a href="/Projects" class="mb-3">< Back to all projects</a>
                <div class="flex-lg-grow-1 align-items-center d-flex flex-column mt-5">
                    <img src="/icons/Logo.svg" class="img-fluid" width="200" />
                    <h1 class="text-center fw-bold mt-3" id="project-name">Project Name</h1>
                    <p class="text-secondary text-center">Project era</p>
                </div>
                <div class="d-flex flex-row justify-content-center align-items-center my-3">
                    <button type="button" class="btn btn-info">Visit GitHub</button>
                </div>
                <div class="mt-5 d-flex align-items-center justify-content-center gap-2" id="topic-container"></div>
                <div class="mt-5 d-flex flex-row align-items-center justify-content-evenly">
                    <p>1/1/2002</p>
                    <p>1/1/2002</p>
                    <p>1/1/2002</p>
                </div>
            </div>
        </div>
        <div class="col-lg-8 p-2">
            <div class="border-box mb-2 p-3 d-flex flex-row align-items-center justify-content-evenly" id="stats-container">
                <p>test</p>
                <p>test</p>
                <p>test</p>
                <p>test</p>
                <p>test</p>
            </div>
            <div class="border-box mb-2 p-3">
                <h4>Screenshots</h4>
                <div class="d-flex flex-row overflow-auto mb-3" id="screenshot-container">

                    <img src="/icons/Logo.svg" class="newsroom-slide mx-2" height="200" />
                    <img src="/icons/Logo.svg" class="newsroom-slide mx-2" height="200" />
                    <img src="/icons/Logo.svg" class="newsroom-slide mx-2" height="200" />
                    <img src="/icons/Logo.svg" class="newsroom-slide mx-2" height="200" />
                    <img src="/icons/Logo.svg" class="newsroom-slide mx-2" height="200" />
                    <img src="/icons/Logo.svg" class="newsroom-slide mx-2" height="200" />
                </div>
            </div>
            <div class="border-box mb-2 p-3">
                <h4>Description</h4>
                <div id="description-container"></div>
            </div>
            <div class="border-box mb-2 p-3">
                <h4 class="mb-3">Related Projects</h4>
                <div class="d-flex flex-row overflow-auto mb-3" id="related-container">

                    <a class="mx-2 mb-0 text-decoration-none" href="/interpersonal/member/view/${member.id}">
                        <div class="d-flex justify-content-center px-3 d-flex flex-column" style="width: 7rem">
                            <img class="square-image" alt="profile image" src="/icons/Logo.svg">
                            <h5 class="text-center fw-bold text-nowrap text-truncate mt-1 mb-0">test</h5>
                        </div>
                    </a>

                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="image-modal" tabindex="-1" aria-labelledby="viewImage" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewImage">View Image</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="image-modal-body"></div>
        </div>
    </div>
</div>



<div th:replace="~{Components :: JS}"></div>
<script>
    let selectedProjectName = document.querySelector("#projectName").value;
    let projectInfo;
    refresh();
    function refresh(){
        const contentFetch = fetch("/api/project/view/" + selectedProjectName);

        Promise.all([contentFetch])
            .then(responses => {
                const response1 = checkStatus(responses[0]);

                return Promise.all([response1]);
            })
            .then(data => {
                let response1 = data[0].json();

                return Promise.all([response1]);
            })
            .then(data => {
                projectInfo = data[0];
                renderBody();
            })
            .catch((response)=>{
                console.log(response);
                response.json()  // Parse the JSON error response
                    .then(errorData => {
                        console.log(errorData);
                    })
                    .catch(error => {
                        console.error("Error parsing error response:", error);
                    });
            });
    }

    function renderBody(){
        document.querySelector("#project-name").textContent = projectInfo.name;
        document.querySelector("#description-container").innerHTML = projectInfo.readmeContentHTML;

        let topicContent = "";
        projectInfo.topics.forEach((topic) => {
            topicContent += `<span class="badge fs-4 rounded-pill bg-info" style="display: inline-block;">${topic}</span>`;
        });
        document.querySelector("#topic-container").innerHTML = topicContent;

        let imageContent = "";
        projectInfo.imageLinks.forEach((image) => {
            imageContent += `<img src="${image}" role="button" class="mx-2" height="200" onclick="selectImage('${image}')" data-toggle="modal" data-target="#image-modal"/>`;
        });
        document.querySelector("#screenshot-container").innerHTML = imageContent;

        document.querySelector("#stats-container").innerHTML = `
            <div>
                <p class="text-center fs-5 fw-bold">Commits</p>
                <p class="text-center fs-3">${projectInfo.commits}</p>
            </div>
            <div>
                <p class="text-center fs-5 fw-bold">Watching</p>
                <p class="text-center fs-3">${projectInfo.watching}</p>
            </div>
            <div>
                <p class="text-center fs-5 fw-bold">Forks</p>
                <p class="text-center fs-3">${projectInfo.forks}</p>
            </div>
            <div>
                <p class="text-center fs-5 fw-bold">Issues</p>
                <p class="text-center fs-3">${projectInfo.issues}</p>
            </div>
        `;


    }

    function selectImage(imageUrl){
        document.querySelector("#image-modal-body").innerHTML = `<img src="${imageUrl}" alt="project screenshot" style="width:100%" />`;
    }
</script>
</body>
</html>